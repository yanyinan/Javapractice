<!DOCTYPE HTML>
<html>
<head>
    <title>登录</title>
    <!-- Custom Theme files -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="keywords"
          content="Easy Subscribe Form Responsive, Login form web template, Sign up Web Templates, Flat Web Templates, Login signup Responsive web template, Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design"/>
    <!-- layui css 导入-->
    <link href="css/layui.css" rel="stylesheet">
    <style>
        .login-main {
            width: 70%;
            margin: 21px auto 0;
            text-align: center;
        }

        .demo-login-other .layui-icon {
            position: relative;
            display: inline-block;
            margin: 0 2px;
            top: 2px;
            font-size: 26px;
        }
    </style>
    <link href="css/style.css" rel="stylesheet" type="text/css" media="all"/>
    <script src="js/login.js"></script>
</head>
<body>
<div class="newsletter">
    <div class="newsletter-main">
        <div class="stamp">
            <img src="images/stamp.png" alt="">
        </div>
        <div class="design">
            <img src="images/design.png">
        </div>
        <div class="layui-tab layui-tab-brief">
            <h1 style="text-align: center">登录</h1>
            <div class="layui-tab-content">
                <!--账号登录 start-->
                <div class="layui-tab-item layui-show">
                    <form class="layui-form">
                        <div class="login-main">
                            <!--用户名或手机号或邮箱 start-->
                            <div class="layui-form-item">
                                <div class="layui-input-wrap">
                                    <div class="layui-input-prefix">
                                        <i class="layui-icon layui-icon-username"></i>
                                    </div>
                                    <input type="text" name="lid"
                                           value=""
                                           lay-verify="required|login_lid"
                                           placeholder="用户名或手机号或邮箱"
                                           lay-reqtext="请填写用户名或手机号或邮箱"
                                           autocomplete="off"
                                           class="layui-input"
                                           lay-affix="clear"
                                           id="login-lid"
                                    >
                                </div>
                            </div>
                            <!--用户名或手机号或邮箱 end-->
                            <!--密码 start-->
                            <div class="layui-form-item">
                                <div class="layui-input-wrap">
                                    <div class="layui-input-prefix">
                                        <i class="layui-icon layui-icon-password"></i>
                                    </div>
                                    <input type="password"
                                           name="password"
                                           id="login-password"
                                           value=""
                                           lay-verify="required|password"
                                           placeholder="密   码"
                                           lay-reqtext="请填写密码"
                                           autocomplete="off"
                                           class="layui-input"
                                           lay-affix="eye">
                                </div>
                            </div>
                            <!--密码 end-->
                            <!--验证码 start-->
                            <div class="layui-form-item">
                                <div class="layui-row">
                                    <div class="layui-col-xs7">
                                        <div class="layui-input-wrap">
                                            <div class="layui-input-prefix">
                                                <i class="layui-icon layui-icon-vercode"></i>
                                            </div>
                                            <input type="text"
                                                   name="captcha"
                                                   id="login-captcha"
                                                   value=""
                                                   lay-verify="required"
                                                   placeholder="验证码"
                                                   lay-reqtext="请填写验证码"
                                                   autocomplete="off"
                                                   class="layui-input"
                                                   lay-affix="clear">
                                        </div>
                                    </div>
                                    <div class="layui-col-xs5">
                                        <div style="margin-left: 10px;">
                                            <img th:src="@{/captcha}"
                                                 onclick="this.src = this.src  +'?'+ Math.random();">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--验证码 end-->
                            <!--记住密码 start-->
                            <div class="layui-form-item">
                                <input type="checkbox" name="remember" lay-skin="primary" title="记住密码">
                                <a href="#forget" style="float: right; margin-top: 7px;">忘记密码？</a>
                            </div>
                            <!--记住密码 end-->
                            <!--登录按钮 start-->
                            <div class="layui-form-item">
                                <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="demo-login">
                                    登录
                                </button>
                            </div>
                            <!--登录按钮 end-->
                        </div>
                    </form>
                </div>
                <!--账号登录 end-->
                <!--邮箱登录 start-->
                <div class="layui-tab-item">
                    <form class="layui-form">
                        <div class="login-main">
                            <div class="layui-form-item">
                                <div class="layui-row">
                                    <div class="layui-col-xs7">
                                        <div class="layui-input-wrap">
                                            <div class="layui-input-prefix">
                                                <i class="layui-icon layui-icon-email"></i>
                                            </div>
                                            <input type="email" name="email" value=""
                                                   lay-verify="required|email"
                                                   placeholder="邮箱" lay-reqtext="请填写邮箱"
                                                   autocomplete="off"
                                                   class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-col-xs5">
                                        <div style="margin-left: 11px;">
                                            <button type="button"
                                                    class="layui-btn layui-btn-fluid layui-btn-primary"
                                                    lay-on="reg-get-vercode">获取验证码
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-wrap">
                                    <div class="layui-input-prefix">
                                        <i class="layui-icon layui-icon-vercode"></i>
                                    </div>
                                    <input type="text" name="code" value="" lay-verify="required"
                                           placeholder="验证码" lay-reqtext="请填写验证码"
                                           autocomplete="off"
                                           class="layui-input">
                                </div>
                            </div>
                            <!--验证码-->
                            <div class="layui-form-item">
                                <div class="layui-row">
                                    <div class="layui-col-xs7">
                                        <div class="layui-input-wrap">
                                            <div class="layui-input-prefix">
                                                <i class="layui-icon layui-icon-vercode"></i>
                                            </div>
                                            <input type="text" name="captcha" value="" lay-verify="required"
                                                   placeholder="验证码"
                                                   lay-reqtext="请填写验证码" autocomplete="off"
                                                   class="layui-input"
                                                   lay-affix="clear">
                                        </div>
                                    </div>
                                    <div class="layui-col-xs5">
                                        <div style="margin-left: 10px;">
                                            <img th:src="@{/captcha}"
                                                 onclick="this.src = this.src  +'?'+ Math.random();">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <input type="checkbox" name="remember" lay-skin="primary" title="记住密码">
                                <a href="#forget" style="float: right; margin-top: 7px;">忘记密码？</a>
                            </div>
                            <div class="layui-form-item">
                                <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="demo-login">
                                    登录
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <!--邮箱登录 end-->
                <!--手机号登录 start-->
                <div class="layui-tab-item">
                    <form class="layui-form">
                        <div class="login-main">
                            <div class="layui-form-item">
                                <div class="layui-row">
                                    <div class="layui-col-xs7">
                                        <div class="layui-input-wrap">
                                            <div class="layui-input-prefix">
                                                <i class="layui-icon layui-icon-cellphone"></i>
                                            </div>
                                            <input type="text" name="phone" value=""
                                                   lay-verify="required|phone"
                                                   placeholder="手机号码" lay-reqtext="请填写手机号码"
                                                   autocomplete="off"
                                                   class="layui-input" id="login-phone">
                                        </div>
                                    </div>
                                    <div class="layui-col-xs5">
                                        <div style="margin-left: 11px;">
                                            <button type="button"
                                                    class="layui-btn layui-btn-fluid layui-btn-primary"
                                                    lay-on="reg-get-vercode">获取验证码
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-wrap">
                                    <div class="layui-input-prefix">
                                        <i class="layui-icon layui-icon-vercode"></i>
                                    </div>
                                    <input type="text" name="code" value="" lay-verify="required"
                                           placeholder="验证码" lay-reqtext="请填写验证码"
                                           autocomplete="off"
                                           class="layui-input">
                                </div>
                            </div>
                            <!--验证码-->
                            <div class="layui-form-item">
                                <div class="layui-row">
                                    <div class="layui-col-xs7">
                                        <div class="layui-input-wrap">
                                            <div class="layui-input-prefix">
                                                <i class="layui-icon layui-icon-vercode"></i>
                                            </div>
                                            <input type="text" name="captcha" value="" lay-verify="required"
                                                   placeholder="验证码"
                                                   lay-reqtext="请填写验证码" autocomplete="off"
                                                   class="layui-input"
                                                   lay-affix="clear">
                                        </div>
                                    </div>
                                    <div class="layui-col-xs5">
                                        <div style="margin-left: 10px;">
                                            <img th:src="@{/captcha}"
                                                 onclick="this.src = this.src  +'?'+ Math.random();">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <input type="checkbox" name="remember" lay-skin="primary" title="记住密码">
                                <a href="#forget" style="float: right; margin-top: 7px;">忘记密码？</a>
                            </div>
                            <div class="layui-form-item">
                                <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="demo-login">
                                    登录
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <!--手机号登录 end-->
            </div>
            <div class="design">
                <img src="images/design.png">
            </div>
            <div class="layui-form-item demo-login-other">
                <div class="login-main">
                    <label>其他登录</label>
                    <ul class="layui-tab-title">
                        <li class="layui-this" onclick="clearAllForms()"><i
                                class="layui-icon layui-icon-username"
                                style="color: #4daf29;"></i></i>
                        </li>
                        <li onclick="clearAllForms()"><i class="layui-icon layui-icon-email"
                                                         style="color: #4daf29;"></i></li>
                        <li onclick="clearAllForms()"><i class="layui-icon layui-icon-cellphone"
                                                         style="color: #4daf29;"></i></li>
                    </ul>
                </div>
            </div>
        </div>
        <!--注册按钮 start-->
        <div class="login-main">
            <label>暂无账号？</label>
            <a th:href="@{/register}" class="login-btn">注册</a>
            <div class="design">
                <img src="images/design.png">
            </div>
        </div>
        <!--注册按钮 end-->
    </div>
</div>
<script src="js/layui.js"></script>
<script>
    // 让表单元素自动获取焦点
    document.getElementById("login-lid").focus();

    layui.use(function () {
        var form = layui.form;
        // 自定义验证规则
        form.verify({
            // 验证用户名，且为必填项
            login_lid: function (value, elem) {
                if (value.length < 6) {
                    return '长度不能小于6位';
                }
            },
            // 验证用户名，且为必填项
            lid: function (value, elem) {
                if (!/^[\S]{6,16}$/.test(value)) {
                    return '必须为 6 到 16 位的非空字符';
                }
                //不能有特殊字符
                if (!/^[a-zA-Z0-9_]+$/.test(value)) {
                    return '用户名不能有特殊字符';
                }

            },
            // 验证密码，且为必填项
            password: function (value, elem) {
                if (!/^[\S]{6,16}$/.test(value)) {
                    return '密码必须为 6 到 16 位的非空字符';
                }
            },
            // 验证邮箱，且为必填项
            email: function (value, elem) {
                if (!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(value)) {
                    return '邮箱格式不正确';
                }
            },
            // 验证手机账号（中国大陆手机号），且为必填项
            phone: function (value, elem) {
                if (!/^1[3-9]\d{9}$/.test(value)) {
                    return '手机号格式不正确';
                }
            },
            // 验证两次密码输入是否一致
            confirmPassword: function (value, elem) {
                if (value !== $('#reg-password').val()) {
                    return '两次密码输入不一致';
                }
            }

        });
        let util = layui.util;
        util.on('lay-on', {
            // 获取验证码
            'reg-get-vercode': function (othis) {
                var isvalid = form.validate('#login-email'); // 主动触发验证，v2.7.0 新增
                // 验证通过
                if (isvalid) {
                    layer.msg('验证码发送中');
                    var email = "2648179906@qq.com";
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", "/getCode", true);
                    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                    xhr.send(JSON.stringify({ "email": "2648179906@qq.com" }));
                    xhr.onreadystatechange = function () {
                        if (xhr.status === 200 && xhr.readyState === 4) {
                            // 请求成功，处理响应数据
                            //操作
                            var responseData = JSON.parse(xhr.response);
                            if (responseData.code === 200) {
                                // 登录成功
                                layui.layer.msg(responseData.data.message);
                            } else {
                                // 登录失败
                            }
                        }
                    }
                }
            }
        });
        // 提交登录事件
        form.on('submit(demo-login)', function (data) {
            var resp = data.field; // 获取表单字段值
            // 创建一个新的XMLHttpRequest对象
            var xhr = new XMLHttpRequest();
            // 设置请求方法和URL
            xhr.open("POST", "/login", true);
            // 设置请求头，以便服务器知道如何解析数据
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            //当请求完成时执行的函数
            xhr.onload = function () {
                if (xhr.status === 200 && xhr.readyState === 4) {
                    // 请求成功，处理响应数据
                    //操作
                    var responseData = JSON.parse(xhr.response);
                    if (responseData.code === 200) {
                        // 登录成功
                        layui.layer.msg(responseData.data.message);
                        window.location.href = responseData.data.url;
                        // window.location.href = "/index";
                    } else {
                        // 登录失败
                        layui.layer.msg(responseData.message);
                    }
                } else {
                    // 请求失败，处理错误信息
                    console.error("请求失败，状态码：" + xhr.status);
                }
            };
            //将表单数据转换为JSON字符串并发送请求
            xhr.send(JSON.stringify(resp));
            return false; // 阻止默认 form 跳转
        });
    })
</script>
</body>
</html>